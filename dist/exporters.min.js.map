{"version":3,"sources":["exporters.coffee","exporters.min.js"],"names":["callWithJQuery","pivotModule","exports","module","require","define","amd","jQuery","$","pivotUtilities","exporters","CSV","pivotData","opts","agg","colAttrs","colKey","colKeys","csv","defaults","encodedUri","i","j","k","l","len","len1","len2","len3","len4","len5","link","m","n","r","result","row","rowAttr","rowAttrs","rowKey","rowKeys","localeStrings","extend","getRowKeys","length","push","getColKeys","aggregatorName","join","getAggregator","value","encodeURI","document","createElement","setAttribute","body","appendChild","click","remove","call","this"],"mappings":"CAAA,WAAA,GAAAA,IAAAA,EAAiB,SAACC,GACd,MAAqB,gBAAXC,UAAyC,gBAAVC,QACrCF,EAAYG,QAAQ,WACC,kBAAVC,SAAyBA,OAAOC,IAC3CD,QAAQ,UAAWJ,GAGnBA,EAAYM,UAEL,SAACC,GCKZ,MDHAA,GAAEC,eAAeC,WAAYC,IAAO,SAACC,EAAWC,GAC5C,GAAAC,GAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,CAcA,KAdArB,GAAWsB,kBAEX5B,EAAOL,EAAEkC,QAAO,KAAUvB,EAAUN,GAEpC2B,EAAU5B,EAAU+B,aACiB,IAAlBH,EAAQI,QAA3BJ,EAAQK,SACR5B,EAAUL,EAAUkC,aACiB,IAAlB7B,EAAQ2B,QAA3B3B,EAAQ4B,SACRP,EAAW1B,EAAU0B,SACrBvB,EAAWH,EAAUG,SAErBoB,KAEAC,KACAf,EAAA,EAAAI,EAAAa,EAAAM,OAAAvB,EAAAI,EAAAJ,ICQEgB,EAAUC,EAASjB,GDPjBe,EAAIS,KAAKR,EACb,IAAqB,IAAlBpB,EAAQ2B,QAAqC,IAArB3B,EAAQ,GAAG2B,OAClCR,EAAIS,KAAKjC,EAAUmC,oBAEnB,KAAAzB,EAAA,EAAAI,EAAAT,EAAA2B,OAAAtB,EAAAI,EAAAJ,ICUAN,EAASC,EAAQK,GDTbc,EAAIS,KAAK7B,EAAOgC,KAAK,KAI7B,KAFAb,EAAOU,KAAKT,GAEZb,EAAA,EAAAI,EAAAa,EAAAI,OAAArB,EAAAI,EAAAJ,IAAA,CAEI,ICSFgB,EAASC,EAAQjB,GDVfa,KACAZ,EAAA,EAAAI,EAAAW,EAAAK,OAAApB,EAAAI,EAAAJ,ICYAU,EAAIK,EAAOf,GDXPY,EAAIS,KAAKX,EAEb,KAAAF,EAAA,EAAAH,EAAAZ,EAAA2B,OAAAZ,EAAAH,EAAAG,ICaAhB,EAASC,EAAQe,GDZblB,EAAMF,EAAUqC,cAAcV,EAAQvB,GACnC,MAAAF,EAAAoC,QACCd,EAAIS,KAAK/B,EAAIoC,SAEbd,EAAIS,KAAK,GACjBV,GAAOU,KAAKT,GAEhB,IADAlB,EAAM,+BACNe,EAAA,EAAAH,EAAAK,EAAAS,OAAAX,EAAAH,EAAAG,ICiBEC,EAAIC,EAAOF,GDhBTf,GAAOgB,EAAEc,KAAK,KAAO,ICyBzB,ODvBA5B,GAAa+B,UAAUjC,GAEvBa,EAAOqB,SAASC,cAAc,KAC9BtB,EAAKuB,aAAa,OAAQlC,GAC1BW,EAAKuB,aAAa,WAAY,kBAC9BF,SAASG,KAAKC,YAAYzB,GAE1BA,EAAK0B,QACL1B,EAAK2B,eCoBVC,KAAKC","file":"exporters.min.js","sourcesContent":["callWithJQuery = (pivotModule) ->\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\n        pivotModule require(\"jquery\")\n    else if typeof define is \"function\" and define.amd # AMD\n        define [\"jquery\"], pivotModule\n    # Plain browser env\n    else\n        pivotModule jQuery\n\ncallWithJQuery ($) ->\n\n    $.pivotUtilities.exporters = \"CSV\": (pivotData, opts) ->\n        defaults = localeStrings: {}\n\n        opts = $.extend(true, {}, defaults, opts)\n\n        rowKeys = pivotData.getRowKeys()\n        rowKeys.push [] if rowKeys.length == 0\n        colKeys = pivotData.getColKeys()\n        colKeys.push [] if colKeys.length == 0\n        rowAttrs = pivotData.rowAttrs\n        colAttrs = pivotData.colAttrs\n\n        result = []\n\n        row = []\n        for rowAttr in rowAttrs\n            row.push rowAttr\n        if colKeys.length == 1 and colKeys[0].length == 0\n            row.push pivotData.aggregatorName\n        else\n            for colKey in colKeys\n                row.push colKey.join(\"-\")\n\n        result.push row\n\n        for rowKey in rowKeys\n            row = []\n            for r in rowKey\n                row.push r\n\n            for colKey in colKeys\n                agg = pivotData.getAggregator(rowKey, colKey)\n                if agg.value()?\n                    row.push agg.value()\n                else\n                    row.push \"\"\n            result.push row\n        csv = \"data:text/csv;charset=utf-8,\"\n        for r in result\n            csv += r.join(',') + \"\\n\";\n\n        encodedUri = encodeURI(csv)\n\n        link = document.createElement(\"a\")\n        link.setAttribute(\"href\", encodedUri)\n        link.setAttribute(\"download\", \"pivottable.csv\")\n        document.body.appendChild(link)\n\n        link.click()\n        link.remove()\n\n","(function() {\n  var callWithJQuery;\n\n  callWithJQuery = function(pivotModule) {\n    if (typeof exports === \"object\" && typeof module === \"object\") {\n      return pivotModule(require(\"jquery\"));\n    } else if (typeof define === \"function\" && define.amd) {\n      return define([\"jquery\"], pivotModule);\n    } else {\n      return pivotModule(jQuery);\n    }\n  };\n\n  callWithJQuery(function($) {\n    return $.pivotUtilities.exporters = {\n      \"CSV\": function(pivotData, opts) {\n        var agg, colAttrs, colKey, colKeys, csv, defaults, encodedUri, i, j, k, l, len, len1, len2, len3, len4, len5, link, m, n, r, result, row, rowAttr, rowAttrs, rowKey, rowKeys;\n        defaults = {\n          localeStrings: {}\n        };\n        opts = $.extend(true, {}, defaults, opts);\n        rowKeys = pivotData.getRowKeys();\n        if (rowKeys.length === 0) {\n          rowKeys.push([]);\n        }\n        colKeys = pivotData.getColKeys();\n        if (colKeys.length === 0) {\n          colKeys.push([]);\n        }\n        rowAttrs = pivotData.rowAttrs;\n        colAttrs = pivotData.colAttrs;\n        result = [];\n        row = [];\n        for (i = 0, len = rowAttrs.length; i < len; i++) {\n          rowAttr = rowAttrs[i];\n          row.push(rowAttr);\n        }\n        if (colKeys.length === 1 && colKeys[0].length === 0) {\n          row.push(pivotData.aggregatorName);\n        } else {\n          for (j = 0, len1 = colKeys.length; j < len1; j++) {\n            colKey = colKeys[j];\n            row.push(colKey.join(\"-\"));\n          }\n        }\n        result.push(row);\n        for (k = 0, len2 = rowKeys.length; k < len2; k++) {\n          rowKey = rowKeys[k];\n          row = [];\n          for (l = 0, len3 = rowKey.length; l < len3; l++) {\n            r = rowKey[l];\n            row.push(r);\n          }\n          for (m = 0, len4 = colKeys.length; m < len4; m++) {\n            colKey = colKeys[m];\n            agg = pivotData.getAggregator(rowKey, colKey);\n            if (agg.value() != null) {\n              row.push(agg.value());\n            } else {\n              row.push(\"\");\n            }\n          }\n          result.push(row);\n        }\n        csv = \"data:text/csv;charset=utf-8,\";\n        for (n = 0, len5 = result.length; n < len5; n++) {\n          r = result[n];\n          csv += r.join(',') + \"\\n\";\n        }\n        encodedUri = encodeURI(csv);\n        link = document.createElement(\"a\");\n        link.setAttribute(\"href\", encodedUri);\n        link.setAttribute(\"download\", \"pivottable.csv\");\n        document.body.appendChild(link);\n        link.click();\n        return link.remove();\n      }\n    };\n  });\n\n}).call(this);\n\n//# sourceMappingURL=exporters.js.map\n"]}